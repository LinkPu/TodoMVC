{"remainingRequest":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/src/App.vue?vue&type=style&index=0&id=7ba5bd90&scoped=true&lang=css&","dependencies":[{"path":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/src/App.vue","mtime":1576485369823},{"path":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/node_modules/css-loader/dist/cjs.js","mtime":1575507635978},{"path":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1575507636816},{"path":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/node_modules/postcss-loader/src/index.js","mtime":1575507636224},{"path":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1575507633447},{"path":"/home/jarvis/coding/gitlab/training15-todo-mvc/todo-mvc/frontend/node_modules/vue-loader/lib/index.js","mtime":1575507636816}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5pbmZvLWRpdiB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHdpZHRoOiA0MDBweDsKICBoZWlnaHQ6IDEwMHB4OwogIGxlZnQ6IDUwJTsKICB0b3A6IDQwJTsKICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSkgdHJhbnNsYXRlWSgtNTAlKTsKfQoudG9kby1kaXYgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB3aWR0aDogNTAlOwogIG1hcmdpbjogNXB4OwogIHRvcDogMTAwcHg7CiAgYmFja2dyb3VuZDogI2ZmZjsKICBsZWZ0OiAyNSU7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpLCB0cmFuc2xhdGVZKC01MCUpOwp9Ci5zZWxlY3QtaWNvbiwKLmlucHV0LWJveCB7CiAgZGlzcGxheTogdGFibGUtY2VsbDsKfQouaW5wdXQtYm94IHsKICBwYWRkaW5nLWxlZnQ6IDVweDsKICBmb250LXNpemU6IDIwcHg7Cn0KLnNlbGVjdC1pY29uIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgdG9wOiA3cHg7CiAgbGVmdDogNXB4OwogIG1hcmdpbi1yaWdodDogNXB4OwogIHBhZGRpbmctcmlnaHQ6IDEwcHg7CiAgZm9udC1zaXplOiAyNXB4Owp9Ci50b2RvLWRpdiAudG9kby1saXN0IHsKICB0b3A6IDUwcHg7CiAgbWF4LWhlaWdodDogNDAwcHg7CiAgYmFja2dyb3VuZDogI2NjYzsKICBvdmVyZmxvdzogYXV0bzsKfQouYnRuLWxpc3QgewogIHBhZGRpbmc6IDEwcHggMjBweDsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBhbGlnbi1pdGVtczogY2VudGVyOwp9Ci5idG4tbGlzdCBidXR0b24gewogIGJvcmRlcjogbm9uZTsKICBmb250LXNpemU6IGluaGVyaXQ7Cn0KLmJ0bi1saXN0IGJ1dHRvbjpob3ZlciB7CiAgYm9yZGVyOiAxcHggc29saWQgI2EzYTNhMzsKfQouYnRuLWxpc3QgYTpob3ZlciB7CiAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CiAgY3Vyc29yOiBwb2ludGVyOwp9Ci5hdXRoLWRpYWxvZyB7CiAgaGVpZ2h0OiA1MDBweDsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KLmF1dGgtYnRuIHsKICB3aWR0aDogMTAwJTsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtZXZlbmx5Owp9Cg=="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div>\n    <div id=\"app\">\n      <van-nav-bar :title=\"navTitle\" :right-text=\"navButton\" @click-right=\"onClickRight()\" />\n      <van-dialog v-model=\"showLogin\" :closeOnClickOverlay=\"true\" :showConfirmButton=\"false\" class=\"auth-dialog\" width=\"600px\" >\n        <div class=\"info-div\">\n          <van-cell-group>\n            <van-field v-model=\"username\" required clearable label=\"用户名\" placeholder=\"请输入用户名\" :error-message=\"errorMessage.account\" @input=\"accountValidation()\" />\n            <van-field v-model=\"password\" type=\"password\" label=\"密码\" placeholder=\"请输入密码\" required :error-message=\"errorMessage.password\" @input=\"accountValidation()\" />\n            <div class=\"auth-btn\">\n              <van-button type=\"primary\" @click=\"doLogin()\" >登录</van-button>\n              <van-button type=\"default\" hairline @click=\"doRegister()\" >注册</van-button>\n            </div>\n          </van-cell-group>\n        </div>\n      </van-dialog>\n      <div class=\"todo-div\">\n        <van-icon name=\"arrow-down\" v-if=\"activeNum + completedNum > 0\" class=\"select-icon\" @click=\"changeAllStatus()\" />\n        <van-icon v-else name=\"plus\" class=\"select-icon\" />\n        <van-field v-model=\"newTodo\" @keyup.enter=\"submitTodo\" class=\"input-box\" ></van-field>\n        <van-list class=\"todo-list\">\n          <van-cell v-for=\"(item, index) in dataList\" v-bind:key=\"item.id\" >\n            <todo :item=\"item\" :index=\"index\" @handleDel=\"handleDel\" @changeDescription=\"changeDescription\" @handleStatus=\"handleStatus\" ></todo>\n          </van-cell>\n        </van-list>\n        <div v-if=\"activeNum + completedNum > 0\" class=\"btn-list\" >\n          <label v-if=\"activeNum == 1\">1 item left</label>\n          <label v-else>{{ activeNum }} items left</label>\n          <van-button text=\"all\" type=\"default\" @click=\"checkToAll()\" ></van-button>\n          <van-button text=\"active\" type=\"default\" @click=\"checkToActive()\" ></van-button>\n          <van-button text=\"completed\" type=\"default\" @click=\"checkToCompleted()\" ></van-button>\n          <a @click=\"clearCompleted()\">clear completed</a>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Qs from \"qs\";\nimport Todo from \"./components/Todo.vue\";\nimport { List, Cell, CellGroup, Field, Dialog, Button, Icon, Overlay, NavBar } from \"vant\";\nexport default {\n  name: \"APP\",\n  components: {\n    Todo,\n    [List.name]: List,\n    [Cell.name]: Cell,\n    [Field.name]: Field,\n    [Button.name]: Button,\n    [Icon.name]: Icon,\n    [Overlay.name]: Overlay,\n    [NavBar.name]: NavBar,\n    [CellGroup.name]: CellGroup,\n    [Dialog.Component.name]: Dialog.Component\n  },\n  data() {\n    return {\n      username: \"\",\n      password: \"\",\n      newTodo: \"\",\n      dataList: [],\n      allData: [],\n      activeList: [],\n      completedList: [],\n      activeNum: 0,\n      completedNum: 0,\n      showLogin: false,\n      navTitle: \"\",\n      isLogin: false,\n      navButton: \"登录/注册\",\n      errorMessage: { account: \"\", password: \"\" }\n    };\n  },\n  mounted() {\n    this.navTitle = this.getCookie(\"username\");\n    if (this.navTitle) {\n      this.navButton = \"注销\";\n      this.isLogin = true;\n    }\n    this.checkToAll();\n  },\n  methods: {\n    onClickRight() {\n      if (this.isLogin) {\n        return this.logout();\n      }\n      this.showLogin = true;\n    },\n    accountValidation() {\n      var validation = true;\n      if (!/^[a-zA-Z0-9_-]{4,16}$/.test(this.username)) {\n        this.errorMessage.account =\n          \"请填写 4 到 16 位（字母，数字，下划线，减号）用户名\";\n        validation = false;\n      } else {\n        this.errorMessage.account = \"\";\n      }\n      if (!/^[a-zA-Z0-9_!.@#$%^&*?]{4,16}$/.test(this.password)) {\n        this.errorMessage.password =\n          \"请填写不少于 4 位（字母，数字，常见特殊字符）密码\";\n        validation = false;\n      } else {\n        this.errorMessage.password = \"\";\n      }\n      return validation;\n    },\n    doLogin() {\n      if (!this.accountValidation()) {\n        return;\n      }\n      var data = Qs.stringify({\n        username: this.username,\n        password: this.password\n      });\n      this.$http.post(\"/login\", data).then(res => {\n        if (res.data) {\n          var data = res.data;\n          var expire = data.expire;\n          delete data.expire;\n          for (var key in data) {\n            this.setCookie(key, data[key], expire);\n          }\n          this.setCookie(\"username\", this.username, expire);\n          this.showLogin = false;\n          this.navTitle = this.username;\n          this.navButton = \"注销\";\n          this.isLogin = true;\n          this.checkToAll();\n        } else {\n          this.errorMessage.username = res.data.username;\n          this.errorMessage.password = res.data.password;\n        }\n      });\n    },\n    doRegister() {\n      if (!this.accountValidation()) {\n        return;\n      }\n      this.$http.post(\"/register\", Qs.stringify({ username: this.username, password: this.password })).then(res => {\n        if (res.status == 200) {\n          this.showLogin = false;\n        } else {\n          this.errorMessage.username = res.data.username;\n          this.errorMessage.password = res.data.password;\n        }\n      });\n    },\n    logout() {\n      this.$http.post(\"/logout\").then(res => {\n        if (res.status == 200) {\n          var data = res.data;\n          var expire = data.expire;\n          delete data.expire;\n          for (var key in data) {\n            this.setCookie(key, data[key], expire);\n          }\n          this.setCookie(\"username\", \"\", -1);\n          this.navTitle = \"\";\n          this.navButton = \"登录/注册\";\n          this.isLogin = false;\n          this.dataList = [];\n          this.allData = [];\n          this.activeList = [];\n          this.completedList = [];\n          this.activeNum = 0;\n          this.completedNum = 0;\n        } else {\n          this.setCookie(\"username\", \"\", -1);\n          this.setCookie(\"accessToken\", \"\", -1);\n          this.setCookie(\"userId\", \"\", -1);\n          alert(res.data); // 登录失败，显示提示语\n        }\n\n      });\n    },\n    submitTodo() {\n      if (!this.newTodo) {\n        return;\n      }\n      var todoItem = { description: this.newTodo };\n      this.$http.post(\"/todos\", Qs.stringify(todoItem)).then(res => {\n        if (res.status == 200) {\n          var data = {\n            _id: res.data._id,\n            user_id: res.data.user_id,\n            description: res.data.description,\n            status: res.data.status\n          };\n          this.allData.unshift(data);\n          this.activeList.unshift(data);\n          this.newTodo = \"\";\n          this.activeNum += 1;\n        } else {\n          if (res.status == 401) {\n            this.showLogin = true\n          }\n        }\n      });\n    },\n    handleDel(index) {\n      this.$http.delete(\"/todos/\" + this.dataList[index]._id).then(res => {\n        if (res.status == 200) {\n          if (this.dataList[index].status == true) {\n            this.activeNum -= 1;\n          } else {\n            this.completedNum -= 1;\n          }\n          this.dataList.splice(index, 1);\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    handleStatus(status, index) {\n      this.$http.patch(\"/todos/\" + this.dataList[index]._id + \"/status\").then(res => {\n        if (res.status == 200) {\n          this.dataList[index].status = res.data.status;\n          if (status) {\n            this.activeList.unshift(this.dataList[index]);\n            this.activeNum += 1;\n            this.completedNum -= 1;\n          } else {\n            this.completedList.unshift(this.dataList[index]);\n            this.activeNum -= 1;\n            this.completedNum += 1;\n          }\n          if (this.dataList === this.allData) {\n            return;\n          }\n          this.dataList.splice(index, 1);\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    checkToAll() {\n      this.$http.get(\"/todos\").then(res => {\n        if (res.data) {\n          this.allData.splice(0, this.allData.length);\n          this.activeList.splice(0, this.activeList.length);\n          this.completedList.splice(0, this.completedList.length);\n          var data = res.data;\n          this.activeNum = 0;\n          this.completedNum = 0;\n          for (var i = 0; i < data.length; i++) {\n            var todo = {\n              _id: data[i]._id,\n              user_id: data[i].user_id,\n              description: data[i].description,\n              status: data[i].status\n            };\n            this.allData.unshift(todo);\n            if (data[i].status == true) {\n              this.activeList.unshift(todo);\n              this.activeNum += 1;\n            } else {\n              this.completedList.unshift(todo);\n              this.completedNum += 1;\n            }\n          }\n          this.dataList = this.allData;\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    checkToActive() {\n      this.$http.get(\"/todos/starts\").then(res => {\n        if (res.status == 200) {\n          this.activeList.splice(0, this.activeList.length);\n          var data = res.data;\n          for (var i = 0; i < data.length; i++) {\n            this.activeList.unshift({\n              _id: data[i]._id,\n              user_id: data[i].user_id,\n              description: data[i].description,\n              status: data[i].status\n            });\n          }\n          this.activeNum = this.activeList.length;\n          this.dataList = this.activeList;\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    checkToCompleted() {\n      this.$http.get(\"/todos/ends\").then(res => {\n        if (res.status == 200) {\n          this.completedList = [];\n          var data = res.data;\n          for (var i = 0; i < data.length; i++) {\n            this.completedList.unshift({\n              _id: data[i]._id,\n              user_id: data[i].user_id,\n              description: data[i].description,\n              status: data[i].status\n            });\n          }\n          this.dataList = this.completedList;\n        } else {\n          alert('error');\n        }\n      });\n    },\n    changeDescription(obj) {\n      this.dataList[obj.index].description = obj.value;\n      this.$http.patch(\"/todos/\" + this.dataList[obj.index]._id + \"/description\",Qs.stringify({ description: obj.value })).then(res => {\n        if (res.status == 200) {\n          this.dataList[obj.index].description = res.data.description;\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    changeAllStatus() {\n      var status;\n      if (this.activeList.length > 0) {\n        status = false;\n      } else {\n        status = true;\n      }\n      this.$http.patch(\"/todos/status\", Qs.stringify({ status: status })).then(res => {\n        if (res.status == 200) {\n          this.completedList.splice(0, this.completedList.length);\n          this.activeList.splice(0, this.activeList.length);\n          this.allData.splice(0, this.allData.length);\n          var data = res.data;\n          this.activeNum = 0;\n          for (var i = 0; i < data.length; i++) {\n            var todo = {\n              _id: data[i]._id,\n              user_id: data[i].user_id,\n              description: data[i].description,\n              status: data[i].status\n            };\n            this.allData.unshift(todo);\n            if (status) {\n              this.activeList.unshift(todo);\n              this.activeNum += 1;\n            } else {\n              this.completedList.unshift(todo);\n              this.completedNum += 1;\n            }\n          }\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    clearCompleted() {\n      this.$http.delete(\"/todos/ends\", {}).then(res => {\n        if (res.status == 200) {\n          this.completedList.splice(0, this.completedList.length);\n          for (var i = 0; i < this.dataList.length; ) {\n            if (!this.dataList[i].status) {\n              this.dataList.splice(i, 1);\n              continue;\n            }\n            i++;\n          }\n          this.completedNum = 0;\n        } else {\n          alert(\"error\");\n        }\n      });\n    },\n    setCookie(cname, cvalue, exseconds) {\n      var d = new Date();\n      d.setTime(d.getTime() + exseconds * 1000);\n      var expires = \"expires=\" + d.toUTCString();\n      document.cookie = cname + \"=\" + cvalue + \"; \" + expires;\n    },\n    getCookie(name) {\n      var reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n      var arr = document.cookie.match(reg);\n      if (arr) {\n        return arr[2];\n      } else {\n        return null;\n      }\n    },\n  }\n};\n</script>\n\n<style scoped>\n.info-div {\n  position: absolute;\n  width: 400px;\n  height: 100px;\n  left: 50%;\n  top: 40%;\n  transform: translateX(-50%) translateY(-50%);\n}\n.todo-div {\n  position: relative;\n  width: 50%;\n  margin: 5px;\n  top: 100px;\n  background: #fff;\n  left: 25%;\n  transform: translateX(-50%), translateY(-50%);\n}\n.select-icon,\n.input-box {\n  display: table-cell;\n}\n.input-box {\n  padding-left: 5px;\n  font-size: 20px;\n}\n.select-icon {\n  position: relative;\n  top: 7px;\n  left: 5px;\n  margin-right: 5px;\n  padding-right: 10px;\n  font-size: 25px;\n}\n.todo-div .todo-list {\n  top: 50px;\n  max-height: 400px;\n  background: #ccc;\n  overflow: auto;\n}\n.btn-list {\n  padding: 10px 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n.btn-list button {\n  border: none;\n  font-size: inherit;\n}\n.btn-list button:hover {\n  border: 1px solid #a3a3a3;\n}\n.btn-list a:hover {\n  text-decoration: underline;\n  cursor: pointer;\n}\n.auth-dialog {\n  height: 500px;\n  position: relative;\n}\n.auth-btn {\n  width: 100%;\n  display: flex;\n  justify-content: space-evenly;\n}\n</style>\n"]}]}